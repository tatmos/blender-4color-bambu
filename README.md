# Blender 4色減色 → 3MF エクスポート（Bambu Studio 向け）

Blender 5.0.1 でメッシュを **4色に減色** し、**色ごとにオブジェクト分割** してから **3MF** でエクスポートするスクリプトです。Bambu Studio 2.5.0.66 などの多色印刷ワークフロー向けです。

## 前提

- **Blender 5.0.1**
- **3MF アドオン**: 3MF のエクスポートには Blender の「3MF format」アドオンが必要です。
  - 編集 → プリファレンス → アドオン → 「3MF」で検索して有効化
  - アドオンが `export_mesh.threemf` または `export_mesh.three_mf` を登録している必要があります

## 使い方

1. Blender で減色したいメッシュオブジェクトを用意する。
   - **頂点カラー** がある場合はそれを元に減色します。
   - 頂点カラーがない場合は **マテリアルの Base Color** を元に減色します。
2. 減色・分割したいオブジェクトを選択する（何も選択していない場合はシーン内の全メッシュが対象）。
3. スクリプトを実行する。
   - スクリプト → ファイルを開く → `export_4color_3mf.py` を選んで「スクリプトを実行」
   - またはテキストエディタに貼り付けて実行
4. 出力先はスクリプト先頭の `OUTPUT_PATH` で変更できます（デフォルト: `D:/3DCG/output_4colors_quantized_only.3mf`）。

## 処理の流れ

1. 選択メッシュから面ごとの色を取得（頂点色 or マテリアル）
2. K-means で 4 色に減色
3. 減色後の色ごとにメッシュを分割し、オブジェクトを新規作成
4. 分割されたオブジェクトだけを選択した状態で 3MF エクスポート

## 設定（スクリプト先頭）

| 変数 | 説明 |
|------|------|
| `OUTPUT_PATH` | 出力 3MF ファイルのパス |
| `NUM_COLORS` | 減色する色数（デフォルト: 4） |
| `KMEANS_ITERATIONS` | 減色の K-means 反復回数 |

## ライセンス

GPL-3.0-or-later
